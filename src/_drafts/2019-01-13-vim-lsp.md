---
layout: post
title: Autocomplete + Vim—in 2019.
tags: dotfiles
---

A common observation can be made with newcomers to Vim; plethoras of plugins
transform the minimal editor into something vaguely resembling an IDE. Often,
it's not long until "autocompletion" comes up, and how Vim's apparent _lack_
thereof spawns posts titled "I can't get YouCompleteMe to work"...

If that sounds uncanny, I speak from a similar experience. Like others before
me, I too tried the lot—YouCompleteMe, Eclim, Tern, Jedi... if this is starting
to sound pessimistic you may have guessed **I uninstalled the lot**, committing
instead to learn Vim's built-in autocompletion. If you take one thing from this
post, please let it be to study `:help ins-completion`—`<C-x><C-l>` still
provides what I need 9 times out of 10.

## But then came Language Servers.

In the background, the development _[VS Code][vscode-site]_ introduced the
[Language Server Protocol][lsp-site] (LSP): an interface in which **servers**
can provide **text-editors** with autocomplete capabilities (et. al). These
LSP-compliant servers—or Language Servers—are different to traditional
autocomplete engines in that they are vendor agnostic; they run as stand-alone
programs on a host machine instead of being bundled within text-editors.

In practice this means you can install one Language Server, and have many
LSP-compliant text-editors use it. The inverse of this relationship means you
can install _one_ LSP plugin in your text-editor, and profit for as many
Language Servers you have installed:

![vim lsp][img-vim-lsp]

## Installing, configuring & using Language Servers.

Hopefully, this is starting to sound feasible to you—at least conceptually. In
my experience the least documented/intuitive part of Language Servers is
**installing**, **configuring** and **using** them. Take for instance the
example configuration that can be found for the
[autozimu/LanguageClient-neovim][lsp-plugin] plugin:

```vim
let g:LanguageClient_serverCommands = {
    \ 'rust': ['~/.cargo/bin/rustup', 'run', 'stable', 'rls'],
    \ 'javascript': ['/usr/local/bin/javascript-typescript-stdio'],
    \ 'javascript.jsx': ['tcp://127.0.0.1:2089'],
    \ 'python': ['/usr/local/bin/pyls'],
    \ }
```

Without digging into the source code, this configuration suggests you can:
<ol type="A">
  <li>Boot up a Language Server by pointing to a binary on the host, or</li>
  <li>Connect to a Language Server that is already listening on a socket.</li>
</ol>


Option A is probably the quickest way to get started; you could `$ npm install
-g javascript-typescript-langserver`, and point LanguageClient-neovim to the
`javascript-typescript-stdio` binary. Job done for Javascript. Want LSP
capabilities for Python too? `$ pip install python-language-server` and point to
`pyls`. Alright... but imagine doing this for multiple languages? And what if
you have multiple machines—say one at home and one at work? What if they install
the Language Servers into subtly different locations, breaking your shared
dotfiles? You might appreciate this tedium kept me from using LSP in Vim.

## Language Server over TCP.

Option B (connect to Language Servers via TCP) solved my issues, and allowed me
to fully integrate LSP into my workflow—something I'm a stickler for. The
difference is we shift responsibility for the Language Server's life-cycle to
the host machine, as opposed to the LanguageClient-neovim plugin. Put another
way, when the host guarantees a Language Server is listening on a specific port,
it provides a contract that decouples Vim (et. al) from machine/plugin specific
idiosyncrasies.

You can ensure the host is responsible for the Language Servers, by starting
them as system daemons. For instance—given both my personal and work laptops run
macOS—I (indirectly) create a launchd plist per language server, and install
them to into `~/Library/LaunchAgents`. These `*.plist` files can of course be
committed to (and installed by) your dotfiles-meaning you can easily
automate/repeat the installation across many machines.

## MacOS Bonus round: Install Language Servers via Homebrew

Alright, let's take everything we discussed and condense it into two of

[img-vim-lsp]: {{ "/assets/vim-lsp.jpg"  | relative_url }}

[lsp-plugin]: https://github.com/autozimu/LanguageClient-neovim
[lsp-site]: https://microsoft.github.io/language-server-protocol/
[vscode-site]: https://code.visualstudio.com/
